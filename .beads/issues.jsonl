{"id":"buildscope-tde","title":"BuildScope MVP","description":"Ship BuildScope: AI-powered NCC compliance assistant for Autodesk Revit. Revit side panel with RAG over pgvector + Gemini.","status":"open","priority":1,"issue_type":"epic","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:03:31.930306+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:03:31.930306+11:00"}
{"id":"buildscope-tde.1","title":"BuildScope POC","description":"**Goal:** Ship a Revit add-in with AI-powered NCC compliance Q\u0026A using RAG over Supabase pgvector and Gemini, ported from the Archie Copilot side panel pattern.\n\n**Architecture:**\n- Supabase Postgres + pgvector for NCC embeddings\n- Supabase Edge Function for RAG queries (embed → search → Gemini → respond)\n- Python ingestion script (one-time NCC PDF processing)\n- C#/.NET 8 WPF Revit add-in (dockable side panel)\n- Gemini for both embeddings (text-embedding-004) and LLM (2.0 Flash)\n\n**Spec:** .space-agents/exploration/planned/2026-02-20-buildscope-poc/spec.md\n**Plan:** .space-agents/exploration/planned/2026-02-20-buildscope-poc/plan.md","status":"open","priority":1,"issue_type":"feature","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:04:14.808855+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:04:14.808855+11:00","dependencies":[{"issue_id":"buildscope-tde.1","depends_on_id":"buildscope-tde","type":"parent-child","created_at":"2026-02-20T11:04:14.811306+11:00","created_by":"thebrownproject"}]}
{"id":"buildscope-tde.1.1","title":"Set up Supabase project and database schema","description":"**Goal:** Create the Supabase project, enable pgvector, create the ncc_chunks table with metadata columns, and deploy the similarity search function.\n\n**Files:**\n- Supabase migrations (applied via MCP or dashboard)\n\n**Steps:**\n1. Create Supabase project (or use existing one)\n2. Enable pgvector extension\n3. Create ncc_chunks table: id, content, embedding(768), volume, part, section, title, applicable_classes (int[]), state_specific, created_at\n4. Create HNSW index on embedding for cosine similarity\n5. Create GIN index on applicable_classes\n6. Create match_ncc_chunks RPC function (query_embedding, filter_volume, filter_class, match_threshold, match_count)\n7. Set GEMINI_API_KEY as Supabase secret\n8. Verify with test row insert and query\n\n**Tests:**\n- [ ] pgvector extension is enabled\n- [ ] ncc_chunks table exists with correct columns and types\n- [ ] match_ncc_chunks function accepts embedding + filters and returns results\n- [ ] Can insert a test row and retrieve it with similarity of 1.0\n- [ ] GEMINI_API_KEY secret is set","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:06:06.179626+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:06:06.179626+11:00","dependencies":[{"issue_id":"buildscope-tde.1.1","depends_on_id":"buildscope-tde.1","type":"parent-child","created_at":"2026-02-20T11:06:06.181412+11:00","created_by":"thebrownproject"}]}
{"id":"buildscope-tde.1.2","title":"Build Python NCC ingestion script","description":"**Goal:** Create a Python script that parses NCC PDFs into section-based chunks with rich metadata, generates embeddings via Gemini text-embedding-004, and uploads to Supabase pgvector.\n\n**Files:**\n- Create: ingestion/ingest.py\n- Create: ingestion/requirements.txt\n- Create: ingestion/.env.example\n\n**Steps:**\n1. Create ingestion/ directory with requirements.txt (pymupdf, supabase, google-genai, python-dotenv, tqdm)\n2. Download NCC PDFs and place in ingestion/pdfs/\n3. Implement PDF text extraction using PyMuPDF\n4. Implement section-based chunking: detect Part/Section headers via regex\n5. Split long sections (\u003e2000 chars) at paragraph boundaries\n6. Detect applicable building classes per chunk\n7. Generate embeddings in batches of 20 with rate limiting\n8. Upload to Supabase in batches of 50\n9. Add dry-run mode\n10. Run ingestion and verify data\n\n**Tests:**\n- [ ] Script runs without errors on NCC PDFs\n- [ ] Chunks have correct volume based on PDF source\n- [ ] Section IDs match NCC format (e.g. \"D2D17\", \"H1V3\")\n- [ ] Each chunk has a 768-dimension embedding\n- [ ] Dry-run mode prints chunks without calling APIs\n- [ ] Data appears in Supabase ncc_chunks table\n- [ ] match_ncc_chunks returns relevant results for a test query","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:06:17.576927+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:06:17.576927+11:00","dependencies":[{"issue_id":"buildscope-tde.1.2","depends_on_id":"buildscope-tde.1","type":"parent-child","created_at":"2026-02-20T11:06:17.579428+11:00","created_by":"thebrownproject"},{"issue_id":"buildscope-tde.1.2","depends_on_id":"buildscope-tde.1.1","type":"blocks","created_at":"2026-02-20T11:08:43.872607+11:00","created_by":"thebrownproject"}]}
{"id":"buildscope-tde.1.3","title":"Deploy Supabase Edge Function for RAG queries","description":"**Goal:** Create and deploy a TypeScript/Deno Edge Function that receives a question + project context, runs vector search with metadata filtering, calls Gemini LLM with retrieved chunks, and returns an answer with NCC section references.\n\n**Files:**\n- Supabase Edge Function: ncc-query (deployed via MCP)\n\n**API Contract:**\n- Request: { question, context: { building_class, state, construction_type }, chat_history? }\n- Response: { answer, references: [{ section, title }] }\n\n**Steps:**\n1. Implement Edge Function with POST handler and input validation\n2. Embed query via Gemini text-embedding-004 REST API\n3. pgvector search via supabase.rpc(\"match_ncc_chunks\") with volume + class filtering\n4. Build system prompt injecting project context and NCC citation format\n5. Call Gemini 2.0 Flash with chunks + system prompt + chat history\n6. Extract structured references from answer text\n7. Return { answer, references }\n8. Deploy with verify_jwt: true\n9. Test with curl for different building classes\n10. Document API contract for C# service\n\n**Tests:**\n- [ ] Edge Function deploys without errors\n- [ ] POST with valid body returns { answer, references }\n- [ ] POST with missing fields returns 400\n- [ ] Answer contains bold NCC section references\n- [ ] Class 1 query retrieves only Volume 2 chunks\n- [ ] Class 3 query retrieves only Volume 1 chunks\n- [ ] Response time under 10 seconds","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:06:29.857552+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:06:29.857552+11:00","dependencies":[{"issue_id":"buildscope-tde.1.3","depends_on_id":"buildscope-tde.1","type":"parent-child","created_at":"2026-02-20T11:06:29.85859+11:00","created_by":"thebrownproject"},{"issue_id":"buildscope-tde.1.3","depends_on_id":"buildscope-tde.1.1","type":"blocks","created_at":"2026-02-20T11:08:43.982539+11:00","created_by":"thebrownproject"},{"issue_id":"buildscope-tde.1.3","depends_on_id":"buildscope-tde.1.2","type":"blocks","created_at":"2026-02-20T11:08:44.082751+11:00","created_by":"thebrownproject"}]}
{"id":"buildscope-tde.1.4","title":"Scaffold Revit add-in project from Archie Copilot","description":"**Goal:** Create BuildScope.sln/.csproj targeting net8.0-windows with WPF, port App.cs from Archie Copilot with new GUID and branding, remove IronPython, verify it builds and loads in Revit.\n\n**Files:**\n- Create: BuildScope.sln, BuildScope.csproj, BuildScope.addin, App.cs\n- Reference: references/archie-copilot/App.cs, .csproj, .addin\n\n**Steps:**\n1. Create BuildScope.sln and .csproj (net8.0-windows, UseWPF=true, x64)\n2. Reference RevitAPI.dll and RevitAPIUI.dll (Private=False)\n3. Add Newtonsoft.Json NuGet. No IronPython\n4. Port App.cs: IExternalApplication, new namespace, new GUID, \"BuildScope\" ribbon tab\n5. Remove RevitCommandHandler and all IronPython/ExternalEvent code\n6. Create BuildScope.addin manifest with unique AddInId\n7. Create placeholder ChatPanel (empty WPF Page + IDockablePaneProvider)\n8. Build and verify in Revit\n\n**Tests:**\n- [ ] Project builds with dotnet build\n- [ ] .addin has unique GUID (not Archie's)\n- [ ] No IronPython dependency\n- [ ] Ribbon tab shows \"BuildScope\" with toggle button\n- [ ] Side panel opens in Revit","status":"open","priority":1,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:06:41.842895+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:06:41.842895+11:00","dependencies":[{"issue_id":"buildscope-tde.1.4","depends_on_id":"buildscope-tde.1","type":"parent-child","created_at":"2026-02-20T11:06:41.844176+11:00","created_by":"thebrownproject"}]}
{"id":"buildscope-tde.1.5","title":"Build models and services layer","description":"**Goal:** Create all C# models (ChatMessage, ProjectContext) and services (Config, BuildScopeService, ProjectManager) that power the add-in.\n\n**Files:**\n- Create: Models/ChatMessage.cs, Models/ProjectContext.cs\n- Create: Services/Config.cs, Services/BuildScopeService.cs, Services/ProjectManager.cs\n\n**Steps:**\n1. ChatMessage.cs: MessageType enum (User, Assistant, Welcome, Loading), Content, References list, Timestamp\n2. ProjectContext.cs: Name, BuildingClass, State, ConstructionType\n3. Config.cs: Supabase URL + API key from env vars or config.json, Save/Load\n4. BuildScopeService.cs: HTTP POST to Edge Function, deserialize { answer, references }\n5. ProjectManager.cs: CRUD for project JSON files in AppData/BuildScope/Projects/, current project tracking\n\n**Tests:**\n- [ ] Config reads/saves Supabase URL and API key\n- [ ] BuildScopeService sends correct POST matching Edge Function contract\n- [ ] BuildScopeService deserializes answer and references\n- [ ] ProjectManager creates/lists/loads/deletes projects\n- [ ] Current project switching works\n- [ ] Error handling for HTTP and file I/O","status":"open","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:06:54.186825+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:06:54.186825+11:00","dependencies":[{"issue_id":"buildscope-tde.1.5","depends_on_id":"buildscope-tde.1","type":"parent-child","created_at":"2026-02-20T11:06:54.188449+11:00","created_by":"thebrownproject"},{"issue_id":"buildscope-tde.1.5","depends_on_id":"buildscope-tde.1.4","type":"blocks","created_at":"2026-02-20T11:08:44.185761+11:00","created_by":"thebrownproject"},{"issue_id":"buildscope-tde.1.5","depends_on_id":"buildscope-tde.1.3","type":"blocks","created_at":"2026-02-20T11:08:44.292517+11:00","created_by":"thebrownproject"}]}
{"id":"buildscope-tde.1.6","title":"Build all views (ChatPanel, ProjectForm, SettingsPanel)","description":"**Goal:** Create the complete WPF UI: ChatPanel with markdown rendering and references footer, ProjectForm with class/state/type dropdowns, SettingsPanel for config, and project selector dropdown.\n\n**Files:**\n- Create/modify: Views/ChatPanel.xaml, Views/ChatPanel.xaml.cs\n- Create: Views/ProjectForm.xaml, Views/ProjectForm.xaml.cs\n- Create: Views/SettingsPanel.xaml, Views/SettingsPanel.xaml.cs\n\n**Steps:**\n1. Port ChatPanel.xaml from Archie: \"BuildScope\" header + gear icon, project dropdown bar, remove Code/Result templates, keep User/Assistant/Loading/Welcome\n2. Add markdown rendering: bold (**text**), bullet lists, section headers\n3. Add References footer: separator + \"References:\" + list of \"§ Section - Title\"\n4. ProjectForm: Name TextBox, Class dropdown (1,1a,2,3,4,5,6,7a,7b,8,9a,9b,9c,10a,10b,10c), State dropdown (NSW,VIC,QLD,SA,WA,TAS,NT,ACT), Type dropdown (A,B,C), Cancel/Create buttons\n5. SettingsPanel: Supabase URL, API Key, Save, back arrow\n6. Wire navigation between views\n\n**Tests:**\n- [ ] Panel renders with BuildScope header and gear icon\n- [ ] Project dropdown shows projects with context\n- [ ] Welcome screen on first run with New Project button\n- [ ] ProjectForm has correct dropdown options\n- [ ] Creating project navigates to chat\n- [ ] SettingsPanel loads/saves config\n- [ ] Markdown rendering works (bold, lists)\n- [ ] References footer displays correctly","status":"open","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:07:07.394919+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:07:07.394919+11:00","dependencies":[{"issue_id":"buildscope-tde.1.6","depends_on_id":"buildscope-tde.1","type":"parent-child","created_at":"2026-02-20T11:07:07.39627+11:00","created_by":"thebrownproject"},{"issue_id":"buildscope-tde.1.6","depends_on_id":"buildscope-tde.1.5","type":"blocks","created_at":"2026-02-20T11:08:44.399371+11:00","created_by":"thebrownproject"}]}
{"id":"buildscope-tde.1.7","title":"Wire up end-to-end chat flow","description":"**Goal:** Connect all pieces: ChatPanel sends questions with project context to BuildScopeService, renders responses with markdown and references, manages per-project session memory, handles project switching and errors.\n\n**Files:**\n- Modify: Views/ChatPanel.xaml.cs, Services/BuildScopeService.cs\n\n**Steps:**\n1. Wire send button: add user message, show loading, call BuildScopeService.QueryAsync\n2. On response: remove loading, add assistant message with references, auto-scroll\n3. Per-project chat memory: Dictionary\u003cstring, ObservableCollection\u003cChatMessage\u003e\u003e, cap 20 messages\n4. Project switching: load project chat or show welcome\n5. Error handling: missing config, network errors, empty results\n6. Send chat history (last 10 messages) with each request\n7. Test full loop: create project -\u003e ask question -\u003e get answer -\u003e follow-up\n\n**Tests:**\n- [ ] Question sends to Edge Function with correct context\n- [ ] Response renders with answer and references\n- [ ] 20-message cap with FIFO eviction\n- [ ] Project switching loads correct chat\n- [ ] Missing config shows helpful error\n- [ ] Network errors display gracefully\n- [ ] Full loop works end-to-end","status":"open","priority":2,"issue_type":"task","owner":"fraserbrown@live.com","created_at":"2026-02-20T11:07:17.767141+11:00","created_by":"thebrownproject","updated_at":"2026-02-20T11:07:17.767141+11:00","dependencies":[{"issue_id":"buildscope-tde.1.7","depends_on_id":"buildscope-tde.1","type":"parent-child","created_at":"2026-02-20T11:07:17.768434+11:00","created_by":"thebrownproject"},{"issue_id":"buildscope-tde.1.7","depends_on_id":"buildscope-tde.1.6","type":"blocks","created_at":"2026-02-20T11:08:44.516187+11:00","created_by":"thebrownproject"}]}
